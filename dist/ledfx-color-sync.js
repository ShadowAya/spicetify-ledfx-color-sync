(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));function D(e,t){return e<t?-1:t<e?1:0}function l(e){return e.reduce(function(e,t){return e+t},0)}var e,t,j=Object.create,r=Object.defineProperty,T=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,V=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,o=(e,t,o)=>(o=null!=e?j(V(e)):{},((t,o,l,n)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let e of a(o))F.call(t,e)||e===l||r(t,e,{get:()=>o[e],enumerable:!(n=T(o,e))||n.enumerable});return t})(!t&&e&&e.__esModule?o:r(o,"default",{value:e,enumerable:!0}),e)),n=(e={"external-global-plugin:react"(e,t){t.exports=Spicetify.React}},function(){return t||(0,e[a(e)[0]])((t={exports:{}}).exports,t),t.exports}),I=(()=>{function e(e){this.colors=e}var t=e.prototype;return t.palette=function(){return this.colors},t.map=function(e){return e},e})(),Q=(M.prototype={volume:function(e){var t=this;return t._volume&&!e||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(e){var t=this,o=t.histo;if(!t._count_set||e){for(var l,n,r=0,a=t.r1;a<=t.r2;a++)for(l=t.g1;l<=t.g2;l++)for(n=t.b1;n<=t.b2;n++)r+=o[w(a,l,n)]||0;t._count=r,t._count_set=!0}return t._count},copy:function(){var e=this;return new M(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(e){var t=this,o=t.histo;if(!t._avg||e){var l,n,r,a,i=0,c=0,s=0,d=0;if(t.r1===t.r2&&t.g1===t.g2&&t.b1===t.b2)t._avg=[t.r1<<3,t.g1<<3,t.b1<<3];else{for(n=t.r1;n<=t.r2;n++)for(r=t.g1;r<=t.g2;r++)for(a=t.b1;a<=t.b2;a++)i+=l=o[w(n,r,a)]||0,c+=l*(n+.5)*8,s+=l*(r+.5)*8,d+=l*(a+.5)*8;t._avg=i?[~~(c/i),~~(s/i),~~(d/i)]:[~~(8*(t.r1+t.r2+1)/2),~~(8*(t.g1+t.g2+1)/2),~~(8*(t.b1+t.b2+1)/2)]}}return t._avg},contains:function(e){var t=this,o=e[0]>>3;return gval=e[1]>>3,bval=e[2]>>3,o>=t.r1&&o<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},S.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var t=this.vboxes,o=0;o<t.size();o++)if(t.peek(o).vbox.contains(e))return t.peek(o).color;return this.nearest(e)},nearest:function(e){for(var t,o,l,n=this.vboxes,r=0;r<n.size();r++)((o=Math.sqrt(Math.pow(e[0]-n.peek(r).color[0],2)+Math.pow(e[1]-n.peek(r).color[1],2)+Math.pow(e[2]-n.peek(r).color[2],2)))<t||void 0===t)&&(t=o,l=n.peek(r).color);return l},forcebw:function(){var e=this.vboxes,t=(e.sort(function(e,t){return D(l(e.color),l(t.color))}),e[0].color),t=(t[0]<5&&t[1]<5&&t[2]<5&&(e[0].color=[0,0,0]),e.length-1),o=e[t].color;251<o[0]&&251<o[1]&&251<o[2]&&(e[t].color=[255,255,255])}},function(e,t){if(!Number.isInteger(t)||t<1||256<t)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!e.length||t<2||256<t)return!1;if(!e.length||t<2||256<t)return!1;for(var o=[],l=new Set,n=0;n<e.length;n++){var r=e[n],a=r.join(",");l.has(a)||(l.add(a),o.push(r))}if(o.length<=t)return new I(o);h=e,c=new Array(32768),h.forEach(function(e){i=w(e[0]>>3,e[1]>>3,e[2]>>3),c[i]=(c[i]||0)+1});var i,c,s,d,u,p,f,g,_,m=c,h=(m.forEach(function(){}),h=m,g=p=d=1e6,_=f=u=0,e.forEach(function(e){(s=e[0]>>3)<d?d=s:u<s&&(u=s),(s=e[1]>>3)<p?p=s:f<s&&(f=s),(s=e[2]>>3)<g?g=s:_<s&&(_=s)}),new M(d,u,p,f,g,_,h)),v=new E(function(e,t){return D(e.count(),t.count())});function x(e,t){for(var o,l=e.size(),n=0;n<1e3;){if(t<=l)return;if(1e3<n++)return;if((o=e.pop()).count()){var r=((e,t)=>{if(t.count()){var o=t.r2-t.r1+1,l=t.g2-t.g1+1,n=Math.max.apply(null,[o,l,t.b2-t.b1+1]);if(1==t.count())return[t.copy()];var r,a,i,c,s=0,d=[],u=[];if(n==o)for(r=t.r1;r<=t.r2;r++){for(c=0,a=t.g1;a<=t.g2;a++)for(i=t.b1;i<=t.b2;i++)c+=e[w(r,a,i)]||0;d[r]=s+=c}else if(n==l)for(r=t.g1;r<=t.g2;r++){for(c=0,a=t.r1;a<=t.r2;a++)for(i=t.b1;i<=t.b2;i++)c+=e[w(a,r,i)]||0;d[r]=s+=c}else for(r=t.b1;r<=t.b2;r++){for(c=0,a=t.r1;a<=t.r2;a++)for(i=t.g1;i<=t.g2;i++)c+=e[w(a,i,r)]||0;d[r]=s+=c}d.forEach(function(e,t){u[t]=s-e});var p,f,g,_,m,o=n==o?"r":n==l?"g":"b",h=o+"1",v=o+"2",x=0;for(r=t[h];r<=t[v];r++)if(s/2<d[r]){for(g=t.copy(),_=t.copy(),m=(p=r-t[h])<=(f=t[v]-r)?Math.min(t[v]-1,~~(r+f/2)):Math.max(t[h],~~(r-1-p/2));!d[m];)m++;for(x=u[m];!x&&d[m-1];)x=u[--m];return g[v]=m,_[h]=g[v]+1,[g,_]}}})(m,o),a=r[0],r=r[1];if(!a)return;e.push(a),r&&(e.push(r),l++)}else e.push(o),n++}}v.push(h),x(v,.75*t);for(var y=new E(function(e,t){return D(e.count()*e.volume(),t.count()*t.volume())});v.size();)y.push(v.pop());x(y,t);for(var b=new S;y.size();)b.push(y.pop());return b});function w(e,t,o){return(e<<10)+(t<<5)+o}function E(e){var t=[],o=!1;function l(){t.sort(e),o=!0}return{push:function(e){t.push(e),o=!1},peek:function(e){return o||l(),t[e=void 0===e?t.length-1:e]},pop:function(){return o||l(),t.pop()},size:function(){return t.length},map:function(e){return t.map(e)},debug:function(){return o||l(),t}}}function M(e,t,o,l,n,r,a){var i=this;i.r1=e,i.r2=t,i.g1=o,i.g2=l,i.b1=n,i.b2=r,i.histo=a}function S(){this.vboxes=new E(function(e,t){return D(e.vbox.count()*e.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function c(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=e.naturalWidth,this.height=this.canvas.height=e.naturalHeight,this.context.drawImage(e,0,0,this.width,this.height)}function s(){}function d(e){return Math.min(255,Math.max(0,e))}function v(e,t,o){return`rgb(${e}, ${t}, ${o})`}function u(e,t,o,l){e=Math.min(1,Math.max(.001,(e-t)/(o-t)));return Math.pow(e,l)}c.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},s.prototype.getColor=function(e,t){return this.getPalette(e,5,t=void 0===t?10:t)[0]},s.prototype.getPalette=function(e,t,o){t=(e=>{var t=e.colorCount,e=e.quality;if(void 0!==t&&Number.isInteger(t)){if(1===t)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");t=Math.max(t,2),t=Math.min(t,20)}else t=10;return{colorCount:t,quality:e=void 0===e||!Number.isInteger(e)||e<1?10:e}})({colorCount:t,quality:o}),o=new c(e),e=((e,t,o)=>{for(var l,n,r,a,i=e,c=[],s=0;s<t;s+=o)l=i[0+(a=4*s)],n=i[1+a],r=i[2+a],!(void 0===(a=i[3+a])||125<=a)||250<l&&250<n&&250<r||c.push([l,n,r]);return c})(o.getImageData().data,o.width*o.height,t.quality),o=Q(e,t.colorCount);return o?o.palette():null},s.prototype.getColorFromUrl=function(t,o,l){var n=this,r=document.createElement("img");r.addEventListener("load",function(){var e=n.getPalette(r,5,l);o(e[0],t)}),r.src=t},s.prototype.getImageData=function(e,n){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){if(200==this.status){var e=new Uint8Array(this.response);i=e.length;for(var t=new Array(i),o=0;o<e.length;o++)t[o]=String.fromCharCode(e[o]);var l=t.join(""),l=window.btoa(l);n("data:image/png;base64,"+l)}},t.send()},s.prototype.getColorAsync=function(e,o,l){var n=this;this.getImageData(e,function(e){var t=document.createElement("img");t.addEventListener("load",function(){var e=n.getPalette(t,5,l);o(e[0],this)}),t.src=e})};var R=0,A=90,B=0,K=.9;function $(e,t=!1){function o(e,t=!1){[l,n,r]=e;var o,l=.299*l+.587*n+.114*r,n=([n,r,a]=[e][0],(Math.max(n,r,a)-Math.min(n,r,a))/255),r=Math.min(u(l,R,A,3),.5),a=u(n,B,K,1.1),i=Math.max(a*r,1e-5);return t&&(t=r,r=l,l=a,a=n,n=i,o=v(...e=e),console.log("%c          ",`background: ${o}; font-size: 20px;`),console.table({"Color (RGB)":[e.join(", ")],Luminance:[r,t],Saturation:[a,l],Priority:[n]})),i}e=e.sort((e,t)=>o(t)-o(e));if(t)for(var l of e)o(l,!0);return e}async function G(e){l=e;var l,o,e=await new Promise(t=>{let o=new MutationObserver(()=>{e()}),e=()=>{var e=document.querySelector(l);e&&(o.disconnect(),t(e))};e(),setTimeout(()=>{o.disconnect(),t(null)},5e3),o.observe(document.body,{childList:!0,subtree:!0})});return e?(o=e,await new Promise((e,t)=>{o.complete?e(o):(o.onload=()=>e(o),o.onerror=()=>t(new Error("Image failed to load")))}),e.crossOrigin="anonymous",e):null}var J=`
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
              "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">

<svg xmlns="http://www.w3.org/2000/svg"
     viewBox="0 0 512 512">
  <path id="ring copy"
        fill="currentColor" stroke="none" stroke-width="0.3"
        d="M 240.00,0.21
           C 240.00,0.21 264.00,0.21 264.00,0.21
             264.00,0.21 276.00,0.91 276.00,0.91
             300.87,2.65 324.65,8.22 348.00,16.95
             373.01,26.30 398.45,41.27 419.00,58.25
             439.59,75.27 457.63,95.40 471.95,118.00
             534.76,217.17 522.88,344.95 443.09,431.00
             423.70,451.91 400.58,469.96 375.00,482.75
             330.78,504.88 295.27,512.57 246.00,512.00
             246.00,512.00 236.00,511.09 236.00,511.09
             215.63,509.66 195.41,505.80 176.00,499.33
             139.83,487.29 108.97,469.02 81.00,443.09
             81.00,443.09 74.17,436.91 74.17,436.91
             31.81,393.29 5.16,336.79 0.91,276.00
             0.91,276.00 0.00,264.00 0.00,264.00
             0.00,264.00 0.00,248.00 0.00,248.00
             0.00,248.00 0.91,236.00 0.91,236.00
             2.95,206.83 10.08,177.63 22.31,151.00
             51.84,86.67 103.14,38.48 170.00,14.69
             186.39,8.86 203.75,4.61 221.00,2.28
             221.00,2.28 240.00,0.21 240.00,0.21 Z
           M 242.00,29.28
           C 242.00,29.28 231.00,30.28 231.00,30.28
             218.22,31.81 205.36,34.04 193.00,37.72
             132.06,55.88 81.40,96.83 52.81,154.00
             6.58,246.46 28.92,359.80 107.00,427.71
             129.44,447.24 155.83,461.94 184.00,471.33
             201.34,477.11 218.78,480.76 237.00,482.09
             237.00,482.09 247.00,483.00 247.00,483.00
             286.55,483.46 322.31,477.04 358.00,459.19
             382.58,446.90 403.12,430.79 422.04,411.00
             501.64,327.75 502.89,193.43 427.71,107.00
             399.89,75.01 366.02,53.34 326.00,40.00
             301.81,31.94 267.42,26.92 242.00,29.28 Z
           M 83.53,154.27
           C 83.53,154.27 285.89,154.26 285.89,154.26
             285.89,154.26 330.94,214.78 330.94,214.78
             330.94,214.78 375.99,154.26 375.99,154.26
             375.99,154.26 436.76,154.26 436.76,154.26
             436.76,154.26 361.31,255.61 361.31,255.61
             361.31,255.61 436.76,356.97 436.76,356.97
             436.76,356.97 375.99,356.97 375.99,356.97
             375.99,356.97 330.94,296.44 330.94,296.44
             330.94,296.44 285.89,356.97 285.89,356.97
             285.89,356.97 225.02,356.99 225.02,356.99
             225.02,356.99 300.56,255.62 300.56,255.62
             300.56,255.62 255.48,195.06 255.48,195.06
             255.48,195.06 113.92,194.99 113.92,194.99
             113.92,194.99 83.53,154.27 83.53,154.27 Z
           M 134.97,357.03
           C 134.97,357.03 74.24,356.95 74.24,356.95
             74.24,356.95 154.32,249.42 154.32,249.42
             154.32,249.42 128.52,214.73 128.52,214.73
             128.52,214.73 240.85,214.78 240.85,214.78
             240.85,214.78 271.16,255.54 271.16,255.54
             271.16,255.54 210.51,255.54 210.51,255.54
             210.51,255.54 134.97,357.03 134.97,357.03 Z" />
</svg>
`,x=o(n()),p=o(n()),y=e=>{let[t,l]=(0,p.useState)(()=>e.getAll());(0,p.useEffect)(()=>{let e=({detail:t})=>{l(e=>({...e,[t.key]:t.value}))};return document.addEventListener("LedFxConfigUpdated",e),()=>{document.removeEventListener("LedFxConfigUpdated",e)}},[]);return{configData:t,setValue:(t,o)=>{e.set(t,o),l(e=>({...e,[t]:o}))},getValue:e=>t[e]}},b={input:"SettingsModal-module__input___v8E2s_ledfxDcolorDsync",parent:"SettingsModal-module__parent___oVk1A_ledfxDcolorDsync",inputContainer:"SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync",colorDisplay:"SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync",toggle:"SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync"},C=class{constructor(e){this.config=e}urlOrNull(){var e=this.config.get("ledFxUrl");return e?`${e=e,(e=e.trim()).endsWith("/")?e.slice(0,-1):e}/api`:null}async makeRequest(e,t,o){var l=this.urlOrNull();if(!l)return null;try{var n,r=await fetch(l+"/"+e,{method:t,headers:{"Content-Type":"application/json"},body:o?JSON.stringify(o):void 0});return r.ok?(n=await r.json()).status&&"success"!==n.status?null:n:null}catch{return null}}async listDevices(){var e;return this.urlOrNull()&&(e=await this.makeRequest("devices","GET"))?Object.entries(e.devices).map(([e,t])=>({id:e,name:t.config.name})):null}async listVirtuals(){var e;return this.urlOrNull()&&(e=await this.makeRequest("virtuals","GET"))?Object.keys(e.virtuals):null}async getEffect(e){return this.urlOrNull()&&(e=await this.makeRequest(`virtuals/${e}/effects`,"GET"))?e.effect:null}async setEffectColors(e,t){var o=await this.getEffect(e);if(!o)return!1;var l,n,r={config:{},type:o?.type},a=this.config.config.presets[this.config.config.selectedPreset].colorData,i=(e=>e=((e,t,o)=>(e=Object.entries(e).filter(([e,t])=>o(e,t)),"k"===t?e.map(([e])=>e):"v"===t?e.map(([,e])=>e):Object.fromEntries(e)))(e.config,"k",(e,t)=>"string"==typeof t&&(t.includes("#")||t.includes("linear-gradient(90deg"))))(o);for([l,n]of Object.entries(a)){var c=((t,o)=>{var e,l,n;if("number"==typeof t)return e=(n=o[t])[0],l=n[1],n=n[2],("#"+d(e).toString(16).padStart(2,"0")+d(l).toString(16).padStart(2,"0")+d(n).toString(16).padStart(2,"0")).toUpperCase();{if(Object.keys(t).length<2)return null;let e="linear-gradient(90deg, ";for(var[r,a]of Object.entries(t)){a=o[a];e+=`${v(a[0],a[1],a[2])} ${r}%, `}return e=e.slice(0,-2)+")"}})(n,t);c&&i.includes(l)&&(r.config[l]=c)}return null!==await this.makeRequest(`virtuals/${e}/effects`,"PUT",r)}},f=o(n());function k(){let[e,t]=(0,f.useState)(null);return(0,f.useEffect)(()=>{let e=e=>{t(e.detail)};return document.addEventListener("albumColorUpdated",e),()=>{document.removeEventListener("albumColorUpdated",e)}},[]),e}var g=o(n()),_={input:"SettingsModal-module__input___v8E2s_ledfxDcolorDsync",parent:"SettingsModal-module__parent___oVk1A_ledfxDcolorDsync",inputContainer:"SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync",colorDisplay:"SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync",toggle:"SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync"},m=Spicetify.classnames,Z=e=>""===e;function W({objKey:o,value:e,originalValue:l,options:t,setFn:n,error:r,noNull:a,label:i}){let c=t.map(e=>e.value);return g.default.createElement("div",{className:_.inputContainer},g.default.createElement("label",null,i||U[o]),r?g.default.createElement("input",{className:m(_.input,"main-dropDown-dropDown"),type:"text",style:{opacity:.6},value:r,disabled:!0}):g.default.createElement("select",{className:m(_.input,"main-dropDown-dropDown"),value:e&&c.includes(e)?e:"",onChange:e=>{var t;t=o,e=e.target.value,Z(e)?l&&!c.includes(l)?n(o,l):n(o,null):n(t,e)}},!a&&g.default.createElement("option",{value:""}),t.map(e=>g.default.createElement("option",{value:e.value},g.default.createElement("span",null,e.title," ",e.subtitle&&g.default.createElement(g.default.Fragment,null,"(",e.subtitle,")"))))))}var h=o(n()),N={input:"SettingsModal-module__input___v8E2s_ledfxDcolorDsync",parent:"SettingsModal-module__parent___oVk1A_ledfxDcolorDsync",inputContainer:"SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync",colorDisplay:"SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync",toggle:"SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync"},P=Spicetify.classnames;function X({objKey:t,value:e,setFn:o,error:l}){return h.default.createElement("div",{className:N.inputContainer},h.default.createElement("label",null,U[t]),h.default.createElement("input",{className:P(N.input,"main-dropDown-dropDown"),type:"text",value:l??e??"",onChange:e=>o(t,e.target.value)}))}function Y({value:e,label:t,setValue:o}){return h.default.createElement("div",{className:N.inputContainer},h.default.createElement("label",null,t),h.default.createElement("input",{className:P(N.input,"main-dropDown-dropDown"),type:"text",value:e??"",onChange:e=>o(e.target.value)}))}function ee({value:e,label:t}){return h.default.createElement("div",{className:N.inputContainer},h.default.createElement("label",null,t),h.default.createElement("input",{className:P(N.input,"main-dropDown-dropDown"),type:"text",value:e??"",readOnly:!0}))}var q=o(n()),te={input:"SettingsModal-module__input___v8E2s_ledfxDcolorDsync",parent:"SettingsModal-module__parent___oVk1A_ledfxDcolorDsync",inputContainer:"SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync",colorDisplay:"SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync",toggle:"SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync"};function oe({objKey:t,value:e,setFn:o}){return q.default.createElement("div",{className:te.toggle},q.default.createElement("input",{type:"checkbox",checked:!0===e,onChange:e=>o(t,e.target.checked)}),q.default.createElement("label",null,U[t]))}Spicetify.classnames;var z=o(n()),le={container:"ColorsConfigMenu-module__container___A-ZV8_ledfxDcolorDsync",select:"ColorsConfigMenu-module__select___byko-_ledfxDcolorDsync",staticInput:"ColorsConfigMenu-module__staticInput___gUq2H_ledfxDcolorDsync"},O=o(n()),ne=e=>O.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",...e,style:{height:e.height,width:e.width},viewBox:"0 0 24 24"},O.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),O.default.createElement("path",{fill:"currentColor",d:"M18.925 3.137a3.027 3.027 0 0 0-4.283.001l-9.507 9.52a3.03 3.03 0 0 0-.885 2.139V18c0 .414.336.75.75.75h3.223c.803 0 1.573-.32 2.14-.887l9.5-9.506a3.03 3.03 0 0 0 0-4.28zM4 20.25a.75.75 0 0 0 0 1.5h16a.75.75 0 0 0 0-1.5z"})),re=e=>O.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",...e,style:{height:e.height,width:e.width},viewBox:"0 0 24 24"},O.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),O.default.createElement("path",{fill:"currentColor",d:"M7 21q-.825 0-1.412-.587T5 19V6q-.425 0-.712-.288T4 5t.288-.712T5 4h4q0-.425.288-.712T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5t-.288.713T19 6v13q0 .825-.587 1.413T17 21zm3-4q.425 0 .713-.288T11 16V9q0-.425-.288-.712T10 8t-.712.288T9 9v7q0 .425.288.713T10 17m4 0q.425 0 .713-.288T15 16V9q0-.425-.288-.712T14 8t-.712.288T13 9v7q0 .425.288.713T14 17"})),ae=e=>O.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",...e,style:{height:e.height,width:e.width},viewBox:"0 0 24 24"},O.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),O.default.createElement("g",{fill:"none"},O.default.createElement("path",{d:"m12.593 23.258-.011.002-.071.035-.02.004-.014-.004-.071-.035q-.016-.005-.024.005l-.004.01-.017.428.005.02.01.013.104.074.015.004.012-.004.104-.074.012-.016.004-.017-.017-.427q-.004-.016-.017-.018m.265-.113-.013.002-.185.093-.01.01-.003.011.018.43.005.012.008.007.201.093q.019.005.029-.008l.004-.014-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014-.034.614q.001.018.017.024l.015-.002.201-.093.01-.008.004-.011.017-.43-.003-.012-.01-.01z"}),O.default.createElement("path",{fill:"currentColor",d:"M10.5 20a1.5 1.5 0 0 0 3 0v-6.5H20a1.5 1.5 0 0 0 0-3h-6.5V4a1.5 1.5 0 0 0-3 0v6.5H4a1.5 1.5 0 0 0 0 3h6.5z"}))),ie=e=>O.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",...e,style:{height:e.height,width:e.width},viewBox:"0 0 24 24"},O.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),O.default.createElement("g",{fill:"none",fillRule:"evenodd"},O.default.createElement("path",{d:"m12.593 23.258-.011.002-.071.035-.02.004-.014-.004-.071-.035q-.016-.005-.024.005l-.004.01-.017.428.005.02.01.013.104.074.015.004.012-.004.104-.074.012-.016.004-.017-.017-.427q-.004-.016-.017-.018m.265-.113-.013.002-.185.093-.01.01-.003.011.018.43.005.012.008.007.201.093q.019.005.029-.008l.004-.014-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014-.034.614q.001.018.017.024l.015-.002.201-.093.01-.008.004-.011.017-.43-.003-.012-.01-.01z"}),O.default.createElement("path",{fill:"currentColor",d:"M21.546 5.111a1.5 1.5 0 0 1 0 2.121L10.303 18.475a1.6 1.6 0 0 1-2.263 0L2.454 12.89a1.5 1.5 0 1 1 2.121-2.121l4.596 4.596L19.424 5.111a1.5 1.5 0 0 1 2.122 0"}))),ce=e=>O.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",...e,style:{height:e.height,width:e.width},viewBox:"0 0 24 24"},O.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),O.default.createElement("g",{fill:"none",fillRule:"evenodd"},O.default.createElement("path",{d:"m12.593 23.258-.011.002-.071.035-.02.004-.014-.004-.071-.035q-.016-.005-.024.005l-.004.01-.017.428.005.02.01.013.104.074.015.004.012-.004.104-.074.012-.016.004-.017-.017-.427q-.004-.016-.017-.018m.265-.113-.013.002-.185.093-.01.01-.003.011.018.43.005.012.008.007.201.093q.019.005.029-.008l.004-.014-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014-.034.614q.001.018.017.024l.015-.002.201-.093.01-.008.004-.011.017-.43-.003-.012-.01-.01z"}),O.default.createElement("path",{fill:"currentColor",d:"m12 14.122 5.303 5.303a1.5 1.5 0 0 0 2.122-2.122L14.12 12l5.304-5.303a1.5 1.5 0 1 0-2.122-2.121L12 9.879 6.697 4.576a1.5 1.5 0 1 0-2.122 2.12L9.88 12l-5.304 5.304a1.5 1.5 0 1 0 2.122 2.12z"}))),se=o(n()),de={container:"ColorsSubmenu-module__container___be--V_ledfxDcolorDsync"};function ue(){return se.default.createElement("div",{className:de.container},se.default.createElement("span",null,"hi"))}function pe({config:e,presetsChanged:t,selectedPresetChanged:o}){e=y(e).configData;k();let[l,n]=(0,z.useState)(null),[r,a]=(0,z.useState)(e.selectedPreset),[i,c]=(0,z.useState)(e.presets),s=i[r];(0,z.useEffect)(()=>{t(i)},[i]),(0,z.useEffect)(()=>{o(r)},[r]);let[d,u]=(0,z.useState)(""),[p,f]=(0,z.useState)(""),g=()=>{"delete"===l?(()=>{let t=r;0!==t&&(c(e=>{e=[...e];return e.splice(t,1),e}),a(0))})():"add"===l?(c(e=>[...e,{name:d,colorData:{}}]),a(i.length)):"rename"===l&&c(e=>{e=[...e];return e[r].name=p,e}),n(null)};return z.default.createElement("div",{className:le.container},z.default.createElement("div",{className:le.select},"rename"===l?z.default.createElement(Y,{value:p,setValue:f,label:"Rename Preset"}):"delete"===l?z.default.createElement(ee,{value:s.name,label:"Delete Preset"}):"add"===l?z.default.createElement(Y,{value:d,setValue:u,label:"Add Preset"}):z.default.createElement(W,{value:r.toString(),originalValue:"",options:i.map((e,t)=>({title:e.name,value:t.toString()})),objKey:"selectedPreset",setFn:(e,t)=>{a(parseInt(t))},label:"Active Preset",noNull:!0}),z.default.createElement("div",null,l?z.default.createElement(z.default.Fragment,null,z.default.createElement("button",{onClick:e=>{e.stopPropagation(),g()}},z.default.createElement(ie,{height:18,width:18})),z.default.createElement("button",{onClick:e=>{e.stopPropagation(),n(null)}},z.default.createElement(ce,{height:18,width:18}))):z.default.createElement(z.default.Fragment,null,z.default.createElement("button",{onClick:e=>{e.stopPropagation(),u("New Preset"),n("add")}},z.default.createElement(ae,{height:18,width:18})),z.default.createElement("button",{onClick:e=>{e.stopPropagation(),f(s.name),n("rename")},disabled:0===r},z.default.createElement(ne,{height:18,width:18})),z.default.createElement("button",{onClick:e=>{e.stopPropagation(),n("delete")},disabled:0===r},z.default.createElement(re,{height:18,width:18}))))),z.default.createElement(ue,null))}Spicetify.classnames;var U={deviceId:"Device",ledFxUrl:"LedFx URL",presets:"Presets",sortColors:"Sort colors by vibrance and lightness",debug:"Debug in console",selectedPreset:"Active Preset"};function fe({config:e}){let{setValue:o,configData:t}=y(e);var l=k();let n=(0,x.useMemo)(()=>new C(e),[]),[r,a]=(0,x.useState)(t),[i,c]=(0,x.useState)(null),[s,d]=(0,x.useState)(null),u=(0,x.useMemo)(()=>Object.entries(t).reduce((e,[t,o])=>{var l=r[t];return"object"==typeof l&&JSON.stringify(l)===JSON.stringify(o)||l!==o&&(e[t]=r[t]),e},{}),[t,r]);var p=e=>{var t,o={};for(t of e)t in u&&(o[t]=u[t]);return o};let f=p(["ledFxUrl","deviceId"]);var g=0<Object.keys(f).length&&r.ledFxUrl;let _=p(["sortColors","selectedPreset","presets"]);var p=0<Object.keys(_).length,m=((0,x.useEffect)(()=>{(async()=>{let e=await n.listDevices();var t=(await n.listVirtuals())?.filter(t=>!e||!e.some(e=>e.id===t))||null;c(e),d(t)})()},[t.ledFxUrl,t.deviceId]),(t,o)=>{a(e=>({...e,[t]:o}))});let h=e=>{for(var t in e)o(t,e[t])};return x.default.createElement("div",{className:b.parent},x.default.createElement("h2",null,"Device"),x.default.createElement(X,{objKey:"ledFxUrl",value:r.ledFxUrl,setFn:m}),x.default.createElement(W,{objKey:"deviceId",originalValue:t.deviceId,value:r.deviceId,options:(i?.map(e=>({title:e.name,subtitle:"Device with ID "+e.id,value:e.id}))??[]).concat(s?.map(e=>({title:e,subtitle:"Virtual device",value:e}))??[]),setFn:m,error:i?void 0:"No devices found, check LedFx URL/instance"}),x.default.createElement(Spicetify.ReactComponent.ButtonPrimary,{disabled:!g,onClick:()=>h(f)},"Save device config"),x.default.createElement("h2",null,"Colors"),x.default.createElement("h4",null,"Current Colors"),x.default.createElement("div",{className:b.colorDisplay},l?l.map((e,t)=>x.default.createElement("div",{key:t,style:{backgroundColor:v(...e),opacity:1}})):"No colors found"),x.default.createElement(oe,{objKey:"sortColors",value:r.sortColors,setFn:m}),x.default.createElement("h4",null,"Color Settings"),x.default.createElement(pe,{config:e,presetsChanged:t=>{a(e=>({...e,presets:t}))},selectedPresetChanged:t=>{a(e=>({...e,selectedPreset:t}))}}),x.default.createElement(Spicetify.ReactComponent.ButtonPrimary,{disabled:!p,onClick:()=>h(_)},"Save color config"))}var ge=o(n()),_e=class extends CustomEvent{constructor(e,t){super("LedFxConfigUpdated",{detail:{key:e,value:t}})}},H=class{constructor(){var t=Spicetify.LocalStorage.get("color-extractor-config");let o;if(t){o=JSON.parse(t);let e=!1;for(var l in H.defaults)l in o||(o[l]=H.defaults[l],e=!0);e&&Spicetify.LocalStorage.set(H.lsKey,JSON.stringify(o))}else Spicetify.LocalStorage.set(H.lsKey,JSON.stringify(H.defaults)),o=H.defaults;this.config=o}getAll(){return this.config}set(e,t){this.config[e]=t,Spicetify.LocalStorage.set(H.lsKey,JSON.stringify(this.config)),document.dispatchEvent(new _e(e,t))}get(e){return this.config[e]}},L=H,me=(L.lsKey="color-extractor-config",L.defaults={deviceId:null,ledFxUrl:"http://127.0.0.1:8888/",sortColors:!0,debug:!1,presets:[{name:"Default",colorData:{gradient:{0:0,20:1,40:2,60:3,80:4,100:0},strobe_color:0}}],selectedPreset:0},class extends CustomEvent{constructor(e){super("albumColorUpdated",{detail:e})}}),he=function(){console.log("LedFX Color Extractor Loaded"),r();let n=new L,o=new C(n),e=document.createElement("div");var t,l;async function r(){var e,t=await async function t(o=0){var e=await G(".main-image-image.cover-art-image.main-image-loaded");if(!e)return null;try{var l=(new s).getPalette(e,5);return l?n.get("sortColors")?$(l,n.get("debug")):l:null}catch(e){return o<3?(console.error("Error extracting color, retrying..."),t(o+1)):(console.error("Error extracting color, giving up."),null)}}();t&&((e=n.get("deviceId"))&&o.setEffectColors(e,t),document.dispatchEvent(new me(t)))}Spicetify.ReactDOM.render(ge.default.createElement(fe,{config:n}),e),t="Set up LedFx",l=()=>{Spicetify.PopupModal.display({title:"Set up LedFx",content:e,isLarge:!0})},new Spicetify.Menu.Item(t,!1,l,J).register(),document.addEventListener("LedFxConfigUpdated",function(e){"sortColors"===e.detail.key&&r()}),Spicetify.Player.addEventListener("songchange",function(){setTimeout(r,500)})};(async()=>{await he()})(),(async()=>{var e;document.getElementById("ledfxDcolorDsync")||((e=document.createElement("style")).id="ledfxDcolorDsync",e.textContent=String.raw`
  .SettingsModal-module__input___v8E2s_ledfxDcolorDsync{background-color:var(--spice-highlight-elevated)!important}.SettingsModal-module__parent___oVk1A_ledfxDcolorDsync{display:flex;flex-direction:column;gap:20px}.SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync{display:flex;flex-direction:row;justify-content:center;gap:20px}.SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync label{width:30%;max-width:30%;display:flex;align-items:center}.SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync{display:flex;gap:20px;padding:0 5px}.SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync>div{width:30px;height:30px;border-radius:50%;outline:1px solid white;outline-offset:2px}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync{display:flex;gap:10px;padding:0 5px;align-items:center}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>label{display:flex;align-items:center}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:22px;height:22px;border:2px solid var(--spice-button,#292a2e);border-radius:4px;position:relative;cursor:pointer;background-color:color-mix(in srgb,var(--spice-button,#292a2e) 20%,transparent)}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]:checked{border-color:var(--spice-button-active,#3f4146);background-color:color-mix(in srgb,var(--spice-button-active,#292a2e) 40%,transparent)}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]:checked::before{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);width:10px;height:5px;border-left:2px solid var(--spice-button-active,#3f4146);border-bottom:2px solid var(--spice-button-active,#3f4146)}.SettingsModal-module__input___v8E2s_ledfxDcolorDsync{background-color:var(--spice-highlight-elevated)!important}.SettingsModal-module__parent___oVk1A_ledfxDcolorDsync{display:flex;flex-direction:column;gap:20px}.SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync{display:flex;flex-direction:row;justify-content:center;gap:20px}.SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync label{width:30%;max-width:30%;display:flex;align-items:center}.SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync{display:flex;gap:20px;padding:0 5px}.SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync>div{width:30px;height:30px;border-radius:50%;outline:1px solid white;outline-offset:2px}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync{display:flex;gap:10px;padding:0 5px;align-items:center}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>label{display:flex;align-items:center}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:22px;height:22px;border:2px solid var(--spice-button,#292a2e);border-radius:4px;position:relative;cursor:pointer;background-color:color-mix(in srgb,var(--spice-button,#292a2e) 20%,transparent)}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]:checked{border-color:var(--spice-button-active,#3f4146);background-color:color-mix(in srgb,var(--spice-button-active,#292a2e) 40%,transparent)}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]:checked::before{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);width:10px;height:5px;border-left:2px solid var(--spice-button-active,#3f4146);border-bottom:2px solid var(--spice-button-active,#3f4146)}.SettingsModal-module__input___v8E2s_ledfxDcolorDsync{background-color:var(--spice-highlight-elevated)!important}.SettingsModal-module__parent___oVk1A_ledfxDcolorDsync{display:flex;flex-direction:column;gap:20px}.SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync{display:flex;flex-direction:row;justify-content:center;gap:20px}.SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync label{width:30%;max-width:30%;display:flex;align-items:center}.SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync{display:flex;gap:20px;padding:0 5px}.SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync>div{width:30px;height:30px;border-radius:50%;outline:1px solid white;outline-offset:2px}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync{display:flex;gap:10px;padding:0 5px;align-items:center}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>label{display:flex;align-items:center}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:22px;height:22px;border:2px solid var(--spice-button,#292a2e);border-radius:4px;position:relative;cursor:pointer;background-color:color-mix(in srgb,var(--spice-button,#292a2e) 20%,transparent)}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]:checked{border-color:var(--spice-button-active,#3f4146);background-color:color-mix(in srgb,var(--spice-button-active,#292a2e) 40%,transparent)}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]:checked::before{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);width:10px;height:5px;border-left:2px solid var(--spice-button-active,#3f4146);border-bottom:2px solid var(--spice-button-active,#3f4146)}.SettingsModal-module__input___v8E2s_ledfxDcolorDsync{background-color:var(--spice-highlight-elevated)!important}.SettingsModal-module__parent___oVk1A_ledfxDcolorDsync{display:flex;flex-direction:column;gap:20px}.SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync{display:flex;flex-direction:row;justify-content:center;gap:20px}.SettingsModal-module__inputContainer___yzMUi_ledfxDcolorDsync label{width:30%;max-width:30%;display:flex;align-items:center}.SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync{display:flex;gap:20px;padding:0 5px}.SettingsModal-module__colorDisplay___Npkyr_ledfxDcolorDsync>div{width:30px;height:30px;border-radius:50%;outline:1px solid white;outline-offset:2px}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync{display:flex;gap:10px;padding:0 5px;align-items:center}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>label{display:flex;align-items:center}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:22px;height:22px;border:2px solid var(--spice-button,#292a2e);border-radius:4px;position:relative;cursor:pointer;background-color:color-mix(in srgb,var(--spice-button,#292a2e) 20%,transparent)}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]:checked{border-color:var(--spice-button-active,#3f4146);background-color:color-mix(in srgb,var(--spice-button-active,#292a2e) 40%,transparent)}.SettingsModal-module__toggle___aHQ-b_ledfxDcolorDsync>input[type=checkbox]:checked::before{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);width:10px;height:5px;border-left:2px solid var(--spice-button-active,#3f4146);border-bottom:2px solid var(--spice-button-active,#3f4146)}.ColorsConfigMenu-module__container___A-ZV8_ledfxDcolorDsync{display:flex;flex-direction:column;gap:20px}.ColorsConfigMenu-module__select___byko-_ledfxDcolorDsync{width:100%;display:flex;gap:10px}.ColorsConfigMenu-module__select___byko-_ledfxDcolorDsync>:first-child{flex:1}.ColorsConfigMenu-module__select___byko-_ledfxDcolorDsync>:first-child label{width:200px}.ColorsConfigMenu-module__select___byko-_ledfxDcolorDsync>:last-child{position:relative;height:32px;min-width:116px;display:flex;gap:10px}.ColorsConfigMenu-module__select___byko-_ledfxDcolorDsync>:last-child>button{height:100%;width:32px;display:grid;place-items:center;border-radius:4px;border:none;background-color:var(--spice-highlight-elevated,#292a2e)}.ColorsConfigMenu-module__select___byko-_ledfxDcolorDsync>:last-child>button:disabled{opacity:.5}.ColorsConfigMenu-module__staticInput___gUq2H_ledfxDcolorDsync{background-color:var(--spice-highlight-elevated)!important}.ColorsSubmenu-module__container___be--V_ledfxDcolorDsync{background-color:var(--spice-highlight-elevated)!important;padding:20px;border-radius:30px}
      `.trim(),document.head.appendChild(e))})()})();